# VerbiForge - Translation Management Platform

## Project Overview
VerbiForge is a comprehensive translation management platform built with Node.js/Express that counts words in Excel files and calculates pricing for 100+ languages with project management capabilities.

## Tech Stack
- **Backend**: Node.js, Express.js
- **Database**: Neon Tech (serverless PostgreSQL) - Development & Production branches
- **Authentication**: JWT, Google OAuth
- **File Processing**: XLSX library for Excel files
- **Email**: Mailgun integration
- **Deployment**: Render.com
- **Frontend**: HTML, CSS, JavaScript (vanilla)

## Project Structure
```
├── server.js              # Main Express server
├── package.json           # Dependencies and scripts
├── render.yaml            # Render deployment configuration
├── sitemap.xml            # SEO sitemap for search engines
├── robots.txt             # Search engine crawling guidelines
├── public/                # Static files
│   ├── index.html         # Landing page
│   ├── dashboard.html     # User dashboard
│   ├── login.html         # Login page
│   ├── signup.html        # Registration page
│   ├── admin.html         # Admin panel
│   ├── about.html         # About Us page
│   ├── contact.html       # Contact page
│   ├── style.css          # Main stylesheet
│   └── script.js          # Frontend JavaScript
├── secure-files/         # Encrypted file storage
└── email-service.js      # Email functionality
```

## Key Features
- Excel file upload and word counting
- Multi-language translation pricing
- User authentication and authorization
- Project management system
- Admin panel for user management
- Google OAuth integration
- Email notifications with customizable templates
- File encryption and security
- SEO optimization with sitemap and robots.txt
- Professional footer with LLP registration information
- **Professional Loading Screen**: 4.5-second branded loader on landing page
- **Enhanced Create Project UI**: Compact forms with checkbox-based multi-select language picker
- **License System**: Free/Professional license management with restrictions
- **User ID System**: Unique 5-digit incremental user IDs starting from 70000
- **Main User & Sub-Users**: Organization structure with main users and sub-accounts
- **Organization Projects**: Main users can view all projects from their sub-accounts
- **Professional Admin UI**: Modern SaaS-style admin interface with sidebar redesign
- **Database Management Tools**: Admin panel for database schema management

## Deployment Information

### Production Environment
- **URL**: www.verbiforge.com
- **Branch**: master
- **Environment**: production
- **Database**: Neon Tech Production Branch
- **Admin Email**: sid@verbiforge.com
- **Super Admin Password**: admin123

### Staging Environment
- **URL**: staging.verbiforge.com
- **Branch**: staging
- **Environment**: staging
- **Database**: Neon Tech Development Branch
- **Admin Email**: sid@verbiforge.com
- **Super Admin Password**: admin123

## Deployment Process

### Staging Deployment
1. Make changes locally
2. Switch to staging branch: `git checkout staging`
3. Merge changes: `git merge main` (if needed)
4. Commit changes: `git add . && git commit -m "message"`
5. Push to staging: `git push origin staging`
6. Render automatically deploys from staging branch

### Production Deployment
1. Make changes locally
2. Switch to master branch: `git checkout master`
3. Merge staging: `git merge staging`
4. Push to master: `git push origin master`
5. Render automatically deploys from master branch

## Environment Variables
- `NODE_ENV`: production/staging/development
- `PORT`: 10000 (Render), 3000 (local)
- `JWT_SECRET`: Authentication secret
- `DATABASE_URL`: Neon PostgreSQL connection string (separate for staging/production)
- `GOOGLE_CLIENT_ID`: Google OAuth
- `GOOGLE_CLIENT_SECRET`: Google OAuth
- `MAILGUN_API_KEY`: Email service
- `MAILGUN_DOMAIN`: Email domain
- `APP_URL`: Application URL

## Database Schema
- **users**: User accounts and authentication with license system (Free/Professional/Professional - Sub Account)
- **projects**: Translation projects with user relationships
- **files**: Uploaded file metadata
- **translations**: Translation requests and status
- **email_templates**: Customizable email templates with variables
- **settings**: Application settings and configuration
- **contacts**: Contact form submissions
- **user_relationships**: Main user and sub-user relationships for organization structure

## SEO Features
- **Sitemap.xml**: Complete site structure with all 8 pages, priorities, and change frequencies
- **Robots.txt**: Search engine crawling guidelines with sitemap reference
- **Sitemap References**: Added to HTML pages for better SEO discovery
- **Server Routes**: Dedicated endpoints for sitemap.xml and robots.txt access
- **Professional Footer**: Updated copyright with LLP registration information

## File Processing
- Supports .xlsx and .xls files
- Extracts text from all sheets
- Counts words using whitespace separation
- Calculates pricing based on word count and language
- Stores files securely with encryption

## Organization Projects Feature
- **Main User Dashboard**: "Org. Projects" button in sidebar for main users
- **Project Aggregation**: View all projects created by sub-accounts
- **Professional Table Layout**: Clean SaaS-style table showing project details
- **Sub-Account Filter**: Dropdown to filter projects by specific sub-account
- **Project Details**: Name, Cost, Status, Languages, Sub-Account, Created Date
- **Real-time Updates**: Projects update automatically when sub-accounts create new ones
- **Responsive Design**: Mobile-friendly table with proper spacing

## Authentication System
- JWT-based authentication
- Google OAuth integration
- Role-based access (user/admin/super_admin)
- License system (Free/Professional)
- Session management
- Password hashing with bcrypt
- **Super Admin Accounts**:
  - `sid@verbiforge.com` (password: admin123)
  - `sid.bandewar@gmail.com` (password: admin123)

## License System & User Management
- **Default License**: All new users automatically assigned "Free" license
- **License Restrictions**: Free users cannot submit projects with "Quote Generated" status
- **License Upgrade**: Professional license allows full project submission
- **User ID System**: Unique 5-digit incremental IDs starting from 70000
- **Main User & Sub-Users**: Organization structure for enterprise users
- **Sub-User License**: Automatically changes to "Professional - Sub Account" when attached
- **Organization Projects**: Main users can view all projects from sub-accounts
- **Admin License Management**: Change user licenses from admin panel
- **User Details Modal**: Professional popup with license management and organization structure

## Admin Panel UI & Features
- **Professional Sidebar**: Modern SaaS-style sidebar with section headers (Main, Management, Communication, Account)
- **Custom Scrollbar**: Professional gray gradient scrollbar matching admin theme
- **Dashboard Redesign**: Compact cards in single row for professional appearance
- **User Management**: Enhanced table with User ID search and license management
- **User Details Modal**: Professional popup with license management and organization structure
- **Organization Structure Table**: Compact 5-column layout (Type, Name, Email, License, Actions)
- **Database Management Tools**: Admin panel for database schema management and migrations
- **Professional Modals**: Consistent styling with proper z-index management
- **Responsive Design**: Mobile-friendly interface with proper spacing

## Email Template Management System
- **WYSIWYG Editor**: Visual email template editor with live preview
- **Source Toggle**: Switch between formatted preview and HTML source code
- **Variable Support**: Dynamic placeholders like {{userName}}, {{projectName}}, etc.
- **Template Types**: Welcome emails, project notifications, admin alerts
- **Professional Test Modal**: Modern popup for test email input (no browser alerts)
- **Active/Inactive Toggle**: Enable/disable templates with visual status indicators
- **Real-time Preview**: See how emails look with sample data
- **Variable Insertion**: Click variables to insert them into templates
- **SaaS-Ready Design**: Modern card-based layout with professional styling
- **Clean Table Design**: Hidden template IDs, removed subject column for cleaner look
- **3-Dot Menu System**: Professional dropdown menu with Edit, Test, and Enable/Disable options
- **Success Feedback**: Professional success popup when saving template changes
- **Confirmation Modals**: Professional confirmation dialogs for enable/disable actions (no browser alerts)
- **Status Indicators**: Visual active/inactive status with colored badges
- **Responsive Design**: Mobile-friendly interface with proper spacing

## Security Features
- Rate limiting
- File size restrictions
- File type validation
- CORS configuration
- Helmet.js security headers
- Input validation and sanitization

## Important Notes
- Never modify production database directly
- Always test changes on staging first
- Staging environment is for testing only
- Production environment serves real users
- File uploads are limited to 10MB
- Rate limiting: 100 requests per 15 minutes
- **Super admin users are automatically created** on server startup
- **Admin login**: Use `sid@verbiforge.com` with password `admin123`
- **Always update .cursorrules** after making significant changes to maintain context
- **SEO Files**: sitemap.xml and robots.txt are served via dedicated server routes
- **LLP Registration**: Verbiforge Solutions LLP (LLPIN: ACR-0511) under Ministry of Corporate Affairs, India
- **Database Migration**: Successfully migrated from Render PostgreSQL to Neon Tech
- **Old Render Database**: Can be safely deleted (no longer used)
- **Neon Branches**: Development branch for staging, Production branch for production
- **Project Cleanup**: Removed unused documentation files, migration scripts, and old SQLite database

## Common Commands
```bash
# Local development
npm run dev

# Staging deployment
git checkout staging
git add . && git commit -m "message"
git push origin staging

# Production deployment
git checkout master
git merge staging
git push origin master

# Check deployment status
curl www.verbiforge.com/health
curl staging.verbiforge.com/health

# Check database health
curl www.verbiforge.com/health/database
curl staging.verbiforge.com/health/database

# Check SEO files
curl www.verbiforge.com/sitemap.xml
curl www.verbiforge.com/robots.txt
```

## Troubleshooting
- Check Render logs for deployment issues
- Verify environment variables are set correctly
- Ensure database connections are working
- Check file permissions for uploads
- Monitor rate limiting and file size limits
- **Admin Login Issues**: Verify super admin exists in database
- **Deployment Issues**: Check if admin users are being created on startup
- **Context Loss**: Refer to .cursorrules file for project information
- **SEO Issues**: Verify sitemap.xml and robots.txt are accessible via server routes
- **Sitemap Access**: Check that server.js has dedicated routes for /sitemap.xml and /robots.txt
- **Database Issues**: Verify Neon connection strings are correct for each environment
- **ON CONFLICT Errors**: Check if database constraints are properly set up after migration
- **Neon Migration**: Both Development and Production branches are active and working
- **Organization Structure Table**: Buttons may get cut off - use compact layout with reduced padding
- **Modal Z-Index Issues**: Ensure proper z-index values for overlapping modals
- **License Restrictions**: Free users cannot submit projects with "Quote Generated" status
- **Sub-User License Changes**: License automatically changes to "Professional - Sub Account" when attached
- **Organization Projects**: Ensure main users have sub-accounts before showing "Org. Projects" button

## Database Migration to Neon Tech
- **Migration Status**: ✅ Complete - Successfully migrated from Render PostgreSQL to Neon Tech
- **Staging Database**: Neon Development Branch (staging.verbiforge.com)
- **Production Database**: Neon Production Branch (www.verbiforge.com)
- **Old Render Database**: Can be safely deleted (no longer used)
- **Benefits**: Serverless architecture, automatic scaling, better performance
- **Connection Strings**: Separate for each environment (staging/production)
- **Data Integrity**: All data successfully migrated with no loss
- **ON CONFLICT Handling**: Implemented fallback logic for database compatibility

## Contact Information
- **Developer**: Sidharth Bandewar
- **Email**: sid@verbiforge.com
- **GitHub**: https://github.com/sidharth07/verbiforge

## Recent Updates & Changes
- **Last Update**: October 15, 2025
- **Recent Changes**:
  - ✅ **Fixed decimal pricing persistence issue** (October 15, 2025):
    - Global pricing now correctly accepts and persists decimal values (e.g., 13.5, 14.5)
    - Fixed parseFloat validation order in applyGlobalPricing function
    - Decimal values now properly saved to database and retrieved on page reload
    - Issue was caused by string-to-number comparison before parseFloat conversion
  - ✅ Updated About Us page founder information:
    - Replaced Sidharth with Sayali as founder
    - Updated to reflect 6 years of experience in translation services
    - Highlighted pharmaceutical expertise as Quality System Specialist at Sanofi
    - Emphasized multiple translation projects for Sanofi's global operations
    - Added focus on pharmaceutical documentation, regulatory compliance, and clinical trials
    - Updated content to emphasize healthcare translation and patient safety
    - Fixed image cropping issues with proper object-fit and positioning
    - Replaced em dash with regular hyphen for consistent punctuation
  - ✅ Fixed About Us page styling to match website theme
    - Updated primary gradient from purple (#667eea, #764ba2) to slate gray (#475569, #1e293b)
    - Updated founder name color to match theme
    - Reduced banner size by 40% and removed logo for more compact appearance
    - Moved LLP registration info from "Our Mission" to "Meet the Founder" section with center alignment
  - ✅ Redesigned Contact page with professional full-page layout
    - Replaced card layout with full-page design matching About Us page
    - Added navigation bar with logo and action buttons
    - Professional header banner with slate gray gradient
    - Enhanced form styling with Inter font and modern inputs
    - Added contact info section and professional footer
    - Responsive design for mobile devices
  - ✅ Removed theme manager feature from admin panel
  - ✅ Added professional loading screen to landing page (4.5-second delay)
  - ✅ Improved Create Project UI on dashboard:
    - Compact project type buttons (horizontal layout)
    - Multi-select language dropdown with checkboxes
    - Language tags match website theme (slate gray gradient)
    - Removed pricing display from language dropdown
    - Reduced banner size by 60%
    - Reduced file upload area by 50%
  - ✅ Enhanced user experience with visual checkboxes for language selection
  - ✅ All changes deployed to production (www.verbiforge.com)
- **Previous Version**: Rolled back to commit 3e3b511 "Fix In-progress tab loading issue" (October 7, 2025)
- **Removed Features**: 
  - Theme management system (removed October 9, 2025)
  - PDF generation system (PDFKit)
  - PDF template customization
  - Privacy Policy and Terms of Service pages
  - Database sync system

## Project Context for AI
When working on this project:
- Always maintain existing functionality
- Test changes on staging before production
- Follow the established code patterns
- Respect the current UI/UX design
- Ensure backward compatibility
- Document any new features or changes
- Consider security implications of changes
- Maintain responsive design principles
- **CRITICAL**: Update .cursorrules file after any significant changes
- **CRITICAL**: Include admin credentials and deployment information
- **CRITICAL**: Document any new environment variables or configuration changes
- **ROLLBACK PROTOCOL**: If issues arise, use `git reset --hard <commit>` and `git push origin <branch> --force`
- **UI/UX IMPROVEMENTS**: Recent updates focused on compact, professional design with better user experience
- **Theme System**: Removed due to implementation complexity - keeping hardcoded slate gray theme
- **PUNCTUATION RULE**: Never use em dashes (—) in content - always use regular hyphens (-) for consistency
