<!DOCTYPE html>
<!-- build: ui-cards-v4 -->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - VerbiForge</title>
    
    <!-- Staging Title Script -->
    <script>
        // Check if we're on staging and update title
        if (window.location.hostname === 'staging.verbiforge.com') {
            document.title = 'Dashboard - VerbiForge - Staging';
        }
    </script>
    
    <script src="client-auth.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Modern SaaS Modal Styles */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(8px);
        }

        .custom-modal {
            background: white;
            border-radius: 16px;
            padding: 0;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .custom-modal.show {
            transform: scale(1);
            opacity: 1;
        }

        .custom-modal-header {
            padding: 32px 32px 24px;
            text-align: center;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .custom-modal-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 600;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .custom-modal-icon.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .custom-modal-icon.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .custom-modal-icon.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .custom-modal-icon.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .custom-modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .custom-modal-message {
            color: #64748b;
            line-height: 1.6;
            font-size: 16px;
            margin-bottom: 0;
        }

        .custom-modal-buttons {
            display: flex;
            gap: 16px;
            padding: 24px 32px 32px;
            background: white;
        }

        /* Modern SaaS Analysis Loading Modal */
        .analysis-loading-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            backdrop-filter: blur(8px);
        }

        .analysis-loading-content {
            background: white;
            border-radius: 20px;
            padding: 48px;
            text-align: center;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid #e2e8f0;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from {
                transform: translateY(-30px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .analysis-loading-icon {
            width: 88px;
            height: 88px;
            border: 3px solid #f1f5f9;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            margin: 0 auto 24px;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.1);
        }

        .analysis-loading-title {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 16px;
            letter-spacing: -0.5px;
        }

        .analysis-loading-message {
            font-size: 16px;
            color: #64748b;
            line-height: 1.6;
            margin-bottom: 32px;
            font-weight: 500;
        }

        .analysis-loading-steps {
            text-align: left;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .analysis-loading-step {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            font-size: 15px;
            color: #475569;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .analysis-loading-step:last-child {
            margin-bottom: 0;
        }

        .analysis-loading-step-icon {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e1;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .analysis-loading-step.completed {
            color: #1e293b;
        }

        .analysis-loading-step.completed .analysis-loading-step-icon {
            background: #10b981;
            border-color: #10b981;
            animation: none;
        }

        .analysis-loading-step.completed::after {
            content: '✓';
            color: #10b981;
            font-weight: 700;
            margin-left: auto;
            font-size: 16px;
        }

        .analysis-loading-step.active {
            color: #1e293b;
        }

        .analysis-loading-step.active .analysis-loading-step-icon {
            border-top-color: #667eea;
            animation: spin 1s linear infinite;
        }

        .custom-modal-btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.025em;
            position: relative;
            overflow: hidden;
        }

        .custom-modal-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .custom-modal-btn:hover::before {
            left: 100%;
        }

        .custom-modal-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .custom-modal-btn.primary:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .custom-modal-btn.secondary {
            background: #f8fafc;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }

        .custom-modal-btn.secondary:hover {
            background: #f1f5f9;
            color: #475569;
            border-color: #cbd5e1;
            transform: translateY(-1px);
        }

        .custom-modal-btn.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .custom-modal-btn.danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: 80px;
            display: flex;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .nav-brand {
            font-size: 2.2em;
            font-weight: bold;
            flex: 1;
            text-align: center;
        }

        .nav-brand svg {
            width: 40px;
            height: 40px;
            margin-right: 12px;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
        }

        .clickable-user-name {
            cursor: pointer;
            color: white;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            text-decoration: none;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .clickable-user-name:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .nav-user #userName.admin-clickable {
            cursor: pointer;
            text-decoration: underline;
            color: #4facfe;
            transition: all 0.3s ease;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .nav-user #userName.admin-clickable:hover {
            background: rgba(79, 172, 254, 0.1);
            transform: translateY(-1px);
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Dashboard Layout with Sidebar */
        .dashboard-layout {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .dashboard-sidebar {
            width: 238px; /* Reduced by 15% from 280px */
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 72px; /* Position below the header */
            left: 0;
            height: calc(100vh - 72px); /* Adjust height to account for header */
            display: flex;
            flex-direction: column;
            z-index: 100;
            border-right: 1px solid #334155;
        }

        /* Modern SaaS Header */
        .saas-header {
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-badge {
            width: 40px;
            height: 40px;
            background: transparent;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .brand-name {
            font-size: 31px;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }

        .user-profile-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }

        .user-profile-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: white;
        }

        /* Hide the old sidebar header */
        .sidebar-header {
            display: none;
        }

        .sidebar-nav {
            flex: 1;
            padding: 24px 0;
        }

        .sidebar-btn {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px 24px;
            color: #cbd5e1;
            text-decoration: none;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            font-weight: 500;
            font-size: 15px;
        }

        .sidebar-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-left-color: #667eea;
        }

        .sidebar-btn.active {
            background: rgba(102, 126, 234, 0.1);
            color: white;
            border-left-color: #667eea;
        }

        .sidebar-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
            flex-shrink: 0;
        }

        .sidebar-footer {
            padding: 24px;
            border-top: 1px solid #334155;
            margin-top: auto;
        }

        .sidebar-footer .sidebar-btn {
            justify-content: flex-start;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: none;
        }

        .sidebar-footer .sidebar-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .super-admin-container {
            display: flex;
            justify-content: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #334155;
        }
        
        .super-admin-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }
        
        .super-admin-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .dashboard-main {
            flex: 1;
            margin-left: 238px; /* Updated to match reduced sidebar width */
            margin-top: 0; /* Remove top margin to eliminate white space */
            padding: 20px;
            background: #f8f9fa;
            min-height: calc(100vh - 72px); /* Adjust height to account for header */
            width: calc(100vw - 238px); /* Updated to match reduced sidebar width */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .dashboard-tabs {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #ddd;
        }

        .tabs-left {
            display: flex;
            gap: 10px;
        }

        .tabs-right {
            display: flex;
            align-items: center;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: #4facfe;
            border-bottom-color: #4facfe;
        }

        .tab-content {
            display: none;
            padding-top: 29px; /* Reduced padding for tighter spacing */
        }

        .tab-content.active {
            display: block;
        }

        .create-project-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0;
        }

        .create-project-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        .create-project-btn span {
            font-size: 18px;
            font-weight: bold;
        }



        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .project-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .project-date {
            font-size: 0.9em;
            color: #666;
        }

        .project-details {
            margin-bottom: 15px;
            flex: 1;
        }

        .project-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .project-total {
            font-size: 1.3em;
            font-weight: bold;
            color: #28a745;
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .project-actions {
            display: flex !important;
            flex-direction: column !important;
            gap: 8px !important;
            margin-top: auto !important;
            flex-shrink: 0 !important;
            width: 100% !important;
        }

        /* Force horizontal layout - override any conflicting styles */
        #projectsList .projects-grid,
        #completedProjectsList .projects-grid {
            display: flex !important;
            flex-direction: row !important;
            flex-wrap: wrap !important;
            gap: 20px !important;
            width: 100% !important;
            max-width: none !important;
        }



        .view-details-btn {
            background: #333;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .view-details-btn:hover {
            background: #555;
            transform: translateY(-1px);
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            flex: 1;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        /* Modern SaaS Project Details Modal */
        .project-details-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .project-details-modal .modal-content {
            background: white;
            border-radius: 20px;
            padding: 0;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid #e2e8f0;
        }

        .project-details-modal .modal-header {
            padding: 24px 32px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 20px 20px 0 0;
        }

        .project-details-modal .modal-header h2 {
            margin: 0;
            color: #1e293b;
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .project-details-modal .modal-header h2::before {
            content: '';
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            display: inline-block;
        }

        .project-details-modal .modal-body {
            padding: 32px;
        }

        .project-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .project-details-modal .detail-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .project-details-modal .detail-label {
            font-weight: 600;
            color: #64748b;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .project-details-modal .detail-value {
            color: #1e293b;
            font-weight: 600;
            font-size: 14px;
        }

        .project-details-modal .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .project-details-modal .status-badge.quote { background: #fef3c7; color: #92400e; }
        .project-details-modal .status-badge.submitted { background: #dbeafe; color: #1e40af; }
        .project-details-modal .status-badge.in-progress { background: #fef3c7; color: #92400e; }
        .project-details-modal .status-badge.proofreading { background: #e9d5ff; color: #7c3aed; }
        .project-details-modal .status-badge.ready { background: #fed7aa; color: #ea580c; }
        .project-details-modal .status-badge.completed { background: #d1fae5; color: #065f46; }

        .project-details-modal .cost-breakdown {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
            border: 1px solid #e2e8f0;
        }

        .project-details-modal .cost-breakdown h4 {
            margin: 0 0 20px 0;
            color: #1e293b;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .project-details-modal .cost-breakdown h4::before {
            content: '';
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }

        .project-details-modal .cost-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e2e8f0;
        }

        .project-details-modal .cost-item:last-child {
            margin-bottom: 0;
        }

        .project-details-modal .cost-item .language {
            font-weight: 600;
            color: #1e293b;
        }

        .project-details-modal .cost-item .cost {
            color: #059669;
            font-weight: 700;
            font-size: 16px;
        }

        .project-details-modal .cost-summary {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
            border: 1px solid #bbf7d0;
        }

        .project-details-modal .cost-summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .project-details-modal .cost-summary-row.subtotal {
            border-bottom: 1px solid #bbf7d0;
            padding-bottom: 16px;
            margin-bottom: 16px;
        }

        .project-details-modal .cost-summary-row.total {
            border-top: 2px solid #059669;
            padding-top: 16px;
            margin-top: 16px;
        }

        .project-details-modal .cost-summary-label {
            font-weight: 600;
            color: #065f46;
            font-size: 14px;
        }

        .project-details-modal .cost-summary-value {
            font-weight: 700;
            color: #065f46;
            font-size: 16px;
        }

        .project-details-modal .cost-summary-value.total {
            font-size: 24px;
            color: #059669;
        }

        .project-details-modal .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            padding: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            border-radius: 8px;
        }

        .project-details-modal .close-btn:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        @media (max-width: 768px) {
            .project-details-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .project-details-modal .modal-content {
                width: 95%;
                max-height: 90vh;
            }
            
            .project-details-modal .modal-body {
                padding: 24px;
            }
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        /* Action rows and buttons */
        .action-row { display: flex; gap: 8px; margin-top: 8px; }
        .btn { border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s ease; }
        .btn-full { width: 100%; }
        .btn-sm { padding: 8px 10px; font-size: 12px; flex: 1; }
        .btn-primary { background: #3e3e3e; color: white; }
        .btn-danger { background: #3e3e3e; color: white; }
        .btn-success { background: #3e3e3e; color: white; }
        .btn-secondary { background: #3e3e3e; color: white; }
        .btn:hover { filter: brightness(0.95); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }

        /* Modern SaaS Dashboard Cards */
        .cards-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, 286px);
            gap: 24px; 
            justify-content: center; 
            padding: 20px;
        }
        
        .project-card {
            background: white;
            border-radius: 16px;
            padding: 21px; /* Increased by 5% from 20px */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            width: 286px;
            transition: all 0.3s ease;
            border: 1px solid #f1f5f9;
        }
        
        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .card-content { 
            display: flex; 
            flex-direction: column; 
            flex: 1;
            min-height: 170px; /* Reduced from 200px */
        }
        
        .card-header { 
            display: flex; 
            align-items: flex-start; 
            justify-content: space-between; 
            gap: 10px; /* Reduced from 12px */
            margin-bottom: 14px; /* Reduced from 16px */
        }
        
        .card-title {
            flex: 1;
            font-size: 1.1em;
            font-weight: 700;
            color: #1e293b;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.3;
        }
        
        .card-meta { 
            display: flex; 
            flex-direction: column; 
            align-items: flex-end; 
            gap: 4px; 
        }
        
        .card-date { 
            font-size: 0.75em; 
            color: #94a3b8; 
            font-weight: 500;
        }
        
        .card-amount { 
            font-size: 1.4em; /* Reduced from 1.5em */
            font-weight: 800; 
            color: #059669; 
            text-align: center; 
            padding: 14px; /* Reduced from 16px */
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px; 
            margin: 14px 0; /* Reduced from 16px */
            border: 1px solid #bbf7d0;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-badge.quote { background: #fef3c7; color: #92400e; }
        .status-badge.submitted { background: #dbeafe; color: #1e40af; }
        .status-badge.in-progress { background: #fef3c7; color: #92400e; }
        .status-badge.proofreading { background: #e9d5ff; color: #7c3aed; }
        .status-badge.ready { background: #fed7aa; color: #ea580c; }
        .status-badge.completed { background: #d1fae5; color: #065f46; }
        
        .project-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px; /* Reduced from 12px */
            margin: 14px 0; /* Reduced from 16px */
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .detail-label {
            font-size: 0.75em;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-value {
            font-size: 0.9em;
            color: #334155;
            font-weight: 600;
        }
        
        .project-type {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .project-type.pure { background: #fef3c7; color: #92400e; }
        .project-type.fusion { background: #dbeafe; color: #1e40af; }

        /* Modern Action Buttons */
        .project-actions { 
            margin-top: auto; 
            padding-top: 16px; 
        }
        
        .action-row { 
            display: flex; 
            gap: 8px; 
            margin-top: 8px; 
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            line-height: 1;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .btn-full { 
            width: 100%; 
            height: 44px; 
            font-size: 14px; 
        }
        
        .btn-sm { 
            height: 36px; 
            padding: 0 16px; 
            font-size: 13px; 
            flex: 1; 
        }
        
        .btn:hover { 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn:focus { 
            outline: none; 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); 
        }
        
        .btn:disabled { 
            opacity: 0.6; 
            cursor: not-allowed; 
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #fff; 
        }
        
        .btn-primary:hover { 
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%); 
        }
        
        .btn-success { 
            background: #10b981; 
            color: #fff; 
        }
        
        .btn-success:hover { 
            background: #059669; 
        }
        
        .btn-danger { 
            background: #ef4444; 
            color: #fff; 
        }
        
        .btn-danger:hover { 
            background: #dc2626; 
        }
        
        .btn-secondary { 
            background: #6b7280; 
            color: #fff; 
        }
        
        .btn-secondary:hover { 
            background: #4b5563; 
        }

        /* Modern Kebab Menu */
        .kebab-wrap { 
            position: relative; 
        }
        
        .kebab-btn {
            width: 32px; 
            height: 32px;
            display: inline-flex; 
            align-items: center; 
            justify-content: center;
            border: 1px solid #e2e8f0; 
            background: #fff; 
            color: #64748b;
            border-radius: 8px; 
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            font-weight: 600;
        }
        
        .kebab-btn:hover { 
            background: #f8fafc; 
            border-color: #cbd5e1;
            color: #475569;
        }
        
        .action-menu {
            position: absolute; 
            top: 40px; 
            right: 0;
            background: #fff; 
            border: 1px solid #e2e8f0; 
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            min-width: 180px; 
            padding: 8px; 
            display: none; 
            z-index: 10;
        }
        
        .action-menu.open { 
            display: block; 
        }
        
        .menu-item { 
            width: 100%; 
            text-align: left; 
            padding: 10px 12px; 
            border-radius: 8px; 
            border: none; 
            background: transparent; 
            cursor: pointer; 
            font-size: 13px; 
            color: #475569;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .menu-item:hover { 
            background: #f1f5f9; 
            color: #1e293b;
        }
        
        .menu-item svg {
            width: 16px;
            height: 16px;
        }

        /* Responsive breakpoints */
        @media (min-width: 1400px) {
            .cards-container { grid-template-columns: repeat(auto-fill, 303px); }
            .project-card { width: 303px; }
        }
        @media (max-width: 1199.98px) {
            .cards-container { grid-template-columns: repeat(auto-fill, 286px); }
            .project-card { width: 286px; }
        }
        @media (max-width: 991.98px) {
            .cards-container { grid-template-columns: repeat(auto-fill, 321px); }
            .project-card { width: 321px; }
        }
        @media (max-width: 767.98px) {
            .cards-container { 
                grid-template-columns: 1fr; 
                gap: 16px; 
                padding: 16px; 
                justify-content: center; 
            }
            .project-card { 
                width: 100%; 
                padding: 17px; 
            }
        }
        
        /* Responsive Sidebar */
        @media (max-width: 1024px) {
            .dashboard-sidebar {
                width: 220px;
            }
            .dashboard-main {
                margin-left: 220px;
                width: calc(100vw - 220px);
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-sidebar {
                width: 200px;
            }
            .dashboard-main {
                margin-left: 200px;
                width: calc(100vw - 200px);
            }
            .sidebar-btn {
                padding: 14px 20px;
                font-size: 14px;
            }
            .sidebar-btn svg {
                width: 18px;
                height: 18px;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-sidebar {
                width: 180px;
            }
            .dashboard-main {
                margin-left: 180px;
                width: calc(100vw - 180px);
            }
            .sidebar-btn {
                padding: 12px 16px;
                font-size: 13px;
            }
            .sidebar-btn svg {
                width: 16px;
                height: 16px;
            }
            .super-admin-badge {
                font-size: 11px;
                padding: 6px 12px;
            }
        }
        
        /* Modern Create Project UI */
        .create-project-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .create-project-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f5f9;
        }
        
        .create-project-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .create-project-header .header-icon {
            width: 48px;
            height: 48px;
            fill: #667eea;
            margin-bottom: 16px;
        }
        
        .create-project-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .create-project-header p {
            color: #64748b;
            font-size: 16px;
            font-weight: 500;
        }
        
        .create-project-form {
            margin-bottom: 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        
        .form-column {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-input {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.2s ease;
            background: #fafafa;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-input::placeholder {
            color: #9ca3af;
        }
        
        /* Upload Zone */
        .upload-zone {
            border: 2px dashed #d1d5db;
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            background: #fafafa;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            user-select: none;
            display: block;
        }
        
        .upload-zone:hover {
            border-color: #667eea;
            background: #f8fafc;
        }
        
        .upload-zone.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 1;
        }
        
        .upload-content {
            pointer-events: none;
            position: relative;
            z-index: 2;
        }
        
        .upload-icon {
            width: 48px;
            height: 48px;
            fill: #9ca3af;
            margin-bottom: 16px;
        }
        
        .upload-content h4 {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .upload-content p {
            color: #6b7280;
            font-size: 14px;
        }
        
        .file-name {
            margin-top: 12px;
            padding: 12px 16px;
            background: #f3f4f6;
            border-radius: 8px;
            font-size: 14px;
            color: #374151;
            font-weight: 500;
            display: none;
            border: 1px solid #e5e7eb;
        }
        
        .file-name.show {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* Project Type Cards */
        .project-type-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .type-card {
            cursor: pointer;
            position: relative;
        }
        
        .type-card input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        
        .type-card-content {
            padding: 24px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            background: white;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .type-card:hover .type-card-content {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }
        
        .type-card input[type="radio"]:checked + .type-card-content {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }
        
        .type-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 16px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .type-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }
        
        .fusion-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .pure-icon {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .type-info h4 {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .type-subtitle {
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .type-description {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.4;
        }
        
        /* Language Selector */
        .language-selector {
            position: relative;
        }
        
        .language-dropdown {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: #fafafa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .language-dropdown:hover {
            border-color: #667eea;
            background: white;
        }
        
        .language-dropdown.active {
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .dropdown-arrow {
            width: 20px;
            height: 20px;
            fill: #6b7280;
            transition: transform 0.2s ease;
        }
        
        .language-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .language-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .language-options.show {
            display: block;
        }
        
        .language-search {
            padding: 16px;
            border-bottom: 1px solid #f1f5f9;
            background: #fafafa;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }
        
        .language-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .language-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s ease;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .language-option:hover {
            background: #f8fafc;
        }
        
        .language-option.selected {
            background: #f0f4ff;
            color: #667eea;
            font-weight: 600;
        }
        
        .selected-languages {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        
        .language-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f0f4ff;
            color: #667eea;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid #e0e7ff;
        }
        
        .language-tag .remove-btn {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 16px;
            justify-content: flex-end;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid #f1f5f9;
        }
        
        .btn-primary, .btn-secondary {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f8fafc;
            color: #64748b;
            border: 2px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #f1f5f9;
            color: #475569;
            border-color: #cbd5e1;
        }
        
        .btn-icon {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }
        
        /* Error and Loading States */
        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 16px 20px;
            border-radius: 12px;
            margin: 20px 0;
            display: none;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid #fecaca;
        }
        
        .loading-state {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        .loading-state p {
            color: #6b7280;
            font-size: 16px;
            font-weight: 500;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design for Create Project */
        @media (max-width: 768px) {
            .create-project-container {
                padding: 16px;
            }
            
            .create-project-card {
                padding: 24px;
                border-radius: 16px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .project-type-cards {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn-primary, .btn-secondary {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-brand">
                <svg width="32" height="32" viewBox="0 0 32 32" style="margin-right: 8px; vertical-align: middle;">
                    <defs>
                        <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#667eea" />
                            <stop offset="100%" style="stop-color:#764ba2" />
                        </linearGradient>
                    </defs>
                    <circle cx="16" cy="16" r="15" fill="url(#logoGradient)" stroke="white" stroke-width="2" />
                    <text x="8" y="20" font-family="Arial, sans-serif" font-size="12" font-weight="bold"
                        fill="white">V</text>
                    <text x="18" y="20" font-family="Arial, sans-serif" font-size="12" font-weight="bold"
                        fill="white">F</text>
                </svg>
                VerbiForge
            </div>
            <div class="nav-user">
                <span id="navUserName" class="clickable-user-name">Loading...</span>
            </div>
        </div>
    </nav>

    <!-- Modern SaaS Header -->
    <div class="saas-header">
        <div class="header-brand">
            <div class="logo-badge">
                <svg viewBox="0 0 60 60" width="40" height="40">
                    <defs>
                        <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#f0f0f0;stop-opacity:1" />
                        </linearGradient>
                        <filter id="logoShadow" x="-50%" y="-50%" width="200%" height="200%">
                            <feDropShadow dx="0" dy="1" stdDeviation="1" flood-color="#000000" flood-opacity="0.1"/>
                        </filter>
                    </defs>
                    
                    <!-- Background circle -->
                    <circle cx="30" cy="30" r="28" fill="rgba(255,255,255,0.1)" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                    
                    <!-- V Letter - Modern geometric design -->
                    <path d="M12 42 L22 18 L32 42" fill="url(#logoGradient)" filter="url(#logoShadow)" stroke="white" stroke-width="1.5"/>
                    
                    <!-- F Letter - Modern geometric design -->
                    <path d="M28 18 L28 42 M28 18 L48 18 M28 32 L44 32" fill="url(#logoGradient)" filter="url(#logoShadow)" stroke="white" stroke-width="1.5"/>
                    
                    <!-- Subtle accent line -->
                    <line x1="15" y1="35" x2="45" y2="35" stroke="rgba(255,255,255,0.3)" stroke-width="0.5"/>
                </svg>
            </div>
            <div class="brand-name">VerbiForge</div>
        </div>
        <button class="user-profile-btn" onclick="switchTab('account')">
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="profileUserName">Loading...</span>
        </button>
    </div>

    <!-- Sidebar -->
    <div class="dashboard-sidebar">
        
        <div class="sidebar-nav">
            <button class="sidebar-btn active" data-tab="projects" onclick="switchTab('projects')">
                <svg viewBox="0 0 24 24">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                </svg>
                My Projects
            </button>
            
            <button class="sidebar-btn" data-tab="completed" onclick="switchTab('completed')">
                <svg viewBox="0 0 24 24">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
                Completed Projects
            </button>
            
            <button class="sidebar-btn" data-tab="create" onclick="switchTab('create')">
                <svg viewBox="0 0 24 24">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                Create Project
            </button>
        </div>
        
        <div class="sidebar-footer">
            <button class="sidebar-btn" data-tab="account" onclick="switchTab('account')">
                <svg viewBox="0 0 24 24">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                My Account
            </button>
            
            <button class="sidebar-btn" id="logoutBtn">
                <svg viewBox="0 0 24 24">
                    <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                </svg>
                Logout
            </button>
            
            <div class="super-admin-container">
                <button class="super-admin-badge" id="superAdminBtn" style="display: none;">
                    <svg viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
                    </svg>
                    Super Admin
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="dashboard-main">

        <div id="projectsTab" class="tab-content active">
            <div id="projectsList">
                <div class="empty-state">
                    <h3>Loading projects...</h3>
                </div>
            </div>
        </div>

        <div id="completedTab" class="tab-content">
            <div id="completedProjectsList">
                <div class="empty-state">
                    <h3>Loading completed projects...</h3>
                </div>
            </div>
        </div>

        <div id="createTab" class="tab-content">
            <div class="create-project-container">
                <div class="create-project-card">
                    <div class="create-project-header">
                        <svg viewBox="0 0 24 24" class="header-icon">
                            <path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/>
                        </svg>
                        <h2>Create New Project</h2>
                        <p>Set up your translation project with all the details</p>
                    </div>

                    <form class="create-project-form">
                        <div class="form-grid">
                            <!-- Left Column -->
                            <div class="form-column">
                                <div class="form-group">
                                    <label for="projectName">Project Name</label>
                                    <input type="text" id="projectName" placeholder="Marketing Survey – Q4 2025" class="form-input">
                                </div>

                                <div class="form-group">
                                    <label for="fileInput">Upload File</label>
                                    <label for="fileInput" class="upload-zone" id="uploadZone">
                                        <input type="file" id="fileInput" accept=".xlsx,.xls" class="file-input">
                                        <div class="upload-content">
                                            <svg viewBox="0 0 24 24" class="upload-icon">
                                                <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
                                            </svg>
                                            <h4>Click or drag file to upload</h4>
                                            <p>Supports Excel files (.xlsx, .xls)</p>
                                        </div>
                                    </label>
                                    <div id="fileName" class="file-name"></div>
                                </div>

                                <div class="form-group">
                                    <label>Project Type</label>
                                    <div class="project-type-cards">
                                        <label class="type-card" data-type="fusion">
                                            <input type="radio" name="projectType" value="fusion" checked>
                                            <div class="type-card-content">
                                                <div class="type-icon fusion-icon">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.5 2.54l2.6 1.53c.56-1.24.9-2.62.9-4.07 0-5.18-3.95-9.45-9-9.95zM12 19c-3.87 0-7-3.13-7-7 0-3.53 2.61-6.43 6-6.92V2.05c-5.05.5-9 4.76-9 9.95 0 5.52 4.47 10 9.99 10 3.31 0 6.24-1.61 8.06-4.09l-2.6-1.53C16.17 17.98 14.21 19 12 19z"/>
                                                    </svg>
                                                </div>
                                                <div class="type-info">
                                                    <h4>Fusion</h4>
                                                    <p class="type-subtitle">Standard</p>
                                                    <p class="type-description">AI + human refinement</p>
                                                </div>
                                            </div>
                                        </label>
                                        <label class="type-card" data-type="pure">
                                            <input type="radio" name="projectType" value="pure">
                                            <div class="type-card-content">
                                                <div class="type-icon pure-icon">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                                    </svg>
                                                </div>
                                                <div class="type-info">
                                                    <h4>Pure</h4>
                                                    <p class="type-subtitle">Premium</p>
                                                    <p class="type-description">100% human translation</p>
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column -->
                            <div class="form-column">
                                <div class="form-group">
                                    <label>Select Languages</label>
                                    <div class="language-selector">
                                        <div id="languageDropdown" class="language-dropdown">
                                            <span id="selectedLanguagesText">Choose languages...</span>
                                            <svg viewBox="0 0 24 24" id="dropdownArrow" class="dropdown-arrow">
                                                <path d="M7 10l5 5 5-5z"/>
                                            </svg>
                                        </div>
                                        <div id="languageOptions" class="language-options">
                                            <div class="language-search">
                                                <input type="text" id="languageSearch" placeholder="Search languages..." class="search-input">
                                            </div>
                                            <div id="languageList" class="language-list">
                                                <!-- Language options loaded by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                    <div id="selectedLanguagesTags" class="selected-languages">
                                        <!-- Selected language tags -->
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="button" id="cancelBtn" class="btn-secondary">Cancel</button>
                                    <button type="button" id="analyzeBtn" class="btn-primary">
                                        <svg viewBox="0 0 24 24" class="btn-icon">
                                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                        </svg>
                                        Submit Project
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>

                    <div id="error" class="error-message"></div>
                    <div id="loading" class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Analyzing file...</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="accountTab" class="tab-content">
            <div style="max-width: 75%; margin: 0; background: white; border-radius: 8px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h2 style="margin-bottom: 25px; color: #333; font-size: 24px;">My Account</h2>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <!-- Personal Information -->
                    <div>
                        <h3 style="margin-bottom: 20px; color: #333; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 10px;">Personal Information</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Full Name</label>
                            <input type="text" id="accountName" placeholder="Enter your full name"
                                style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Email Address</label>
                            <input type="email" id="accountEmail" readonly
                                style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f8f9fa; color: #666;">
                        </div>



                        <div style="margin-top: 25px;">
                            <button id="updateProfileBtn"
                                style="background: #333; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 14px; cursor: pointer; transition: background 0.2s;">
                                Update Profile
                            </button>
                        </div>
                    </div>

                    <!-- Account Security -->
                    <div>
                        <h3 style="margin-bottom: 20px; color: #333; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 10px;">Account Security</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Current Password</label>
                            <input type="password" id="currentPassword" placeholder="Enter current password"
                                style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">New Password</label>
                            <input type="password" id="newPassword" placeholder="Enter new password"
                                style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Confirm New Password</label>
                            <input type="password" id="confirmPassword" placeholder="Confirm new password"
                                style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>

                        <div style="margin-top: 25px;">
                            <button id="changePasswordBtn"
                                style="background: #333; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 14px; cursor: pointer; transition: background 0.2s;">
                                Change Password
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Account Information -->
                <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee;">
                    <h3 style="margin-bottom: 20px; color: #333; font-size: 18px;">Account Information</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">User ID</div>
                            <div style="font-weight: 500; color: #333;" id="accountUserId">Loading...</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Account Type</div>
                            <div style="font-weight: 500; color: #333;" id="accountType">Loading...</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">License</div>
                            <div style="font-weight: 500; color: #333;" id="accountLicense">Loading...</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Account Created</div>
                            <div style="font-weight: 500; color: #333;" id="accountCreated">Loading...</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Total Projects</div>
                            <div style="font-weight: 500; color: #333;" id="totalProjects">Loading...</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Completed Projects</div>
                            <div style="font-weight: 500; color: #333;" id="completedProjects">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Email Notifications -->
                <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee;">
                    <h3 style="margin-bottom: 20px; color: #333; font-size: 18px;">Email Notifications</h3>
                    
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <input type="checkbox" id="projectUpdates" style="margin-right: 10px;">
                        <label for="projectUpdates" style="color: #333; cursor: pointer;">Project status updates</label>
                    </div>
                    
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <input type="checkbox" id="newMessages" style="margin-right: 10px;">
                        <label for="newMessages" style="color: #333; cursor: pointer;">New messages from admin</label>
                    </div>
                    
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <input type="checkbox" id="completedProjects" style="margin-right: 10px;">
                        <label for="completedProjects" style="color: #333; cursor: pointer;">Project completion notifications</label>
                    </div>

                    <div style="margin-top: 20px;">
                        <button id="updateNotificationsBtn"
                            style="background: #333; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 14px; cursor: pointer; transition: background 0.2s;">
                            Update Notifications
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Details Modal -->
    <div id="projectDetailsModal" class="project-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Project Details</h2>
                <button class="close-btn" id="closeProjectDetailsBtn">&times;</button>
            </div>
            <div class="modal-body" id="projectDetailsContent">
                <!-- Project details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Analysis Results</h2>
                <button class="close-btn" id="modalCloseBtn">&times;</button>
            </div>

            <div id="resultsContent">
                <!-- Results will be populated here -->
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="saveProjectBtn"
                    style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; flex: 1;">
                    Save Project
                </button>
                <button id="closeModalBtn2"
                    style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Modern SaaS Modal -->
    <div id="customModal" class="custom-modal-overlay">
        <div class="custom-modal">
            <div class="custom-modal-header">
                <div id="modalIcon" class="custom-modal-icon"></div>
                <div id="modalTitle" class="custom-modal-title"></div>
                <div id="modalMessage" class="custom-modal-message"></div>
            </div>
            <div class="custom-modal-buttons">
                <button id="modalPrimaryBtn" class="custom-modal-btn primary"></button>
                <button id="modalSecondaryBtn" class="custom-modal-btn secondary" style="display: none;"></button>
            </div>
        </div>
    </div>

    <!-- Analysis Loading Modal -->
    <div id="analysisLoadingModal" class="analysis-loading-modal">
        <div class="analysis-loading-content">
            <div class="analysis-loading-icon"></div>
            <div class="analysis-loading-title">Calculating Costs</div>
            <div class="analysis-loading-message">Please wait while we analyze your file and calculate translation costs...</div>
            <div class="analysis-loading-steps">
                <div class="analysis-loading-step" id="step1">
                    <div class="analysis-loading-step-icon"></div>
                    <span>Reading Excel file...</span>
                </div>
                <div class="analysis-loading-step" id="step2">
                    <div class="analysis-loading-step-icon"></div>
                    <span>Extracting text content...</span>
                </div>
                <div class="analysis-loading-step" id="step3">
                    <div class="analysis-loading-step-icon"></div>
                    <span>Counting words...</span>
                </div>
                <div class="analysis-loading-step" id="step4">
                    <div class="analysis-loading-step-icon"></div>
                    <span>Calculating costs per language...</span>
                </div>
                <div class="analysis-loading-step" id="step5">
                    <div class="analysis-loading-step-icon"></div>
                    <span>Generating final quote...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let selectedLanguages = [];
        let availableLanguages = {};
        let currentAnalysis = null;
        let selectedProjectType = 'fusion';

        // Custom Modal System
        const CustomModal = {
            show(options) {
                const modal = document.getElementById('customModal');
                const icon = document.getElementById('modalIcon');
                const title = document.getElementById('modalTitle');
                const message = document.getElementById('modalMessage');
                const primaryBtn = document.getElementById('modalPrimaryBtn');
                const secondaryBtn = document.getElementById('modalSecondaryBtn');

                // Set icon
                icon.className = `custom-modal-icon ${options.type || 'info'}`;
                icon.innerHTML = this.getIcon(options.type || 'info');

                // Set content
                title.textContent = options.title || 'Notification';
                message.textContent = options.message || '';

                // Set buttons
                primaryBtn.textContent = options.primaryText || 'OK';
                primaryBtn.onclick = () => {
                    this.hide();
                    if (options.onPrimary) options.onPrimary();
                };

                if (options.secondaryText) {
                    secondaryBtn.style.display = 'block';
                    secondaryBtn.textContent = options.secondaryText;
                    secondaryBtn.onclick = () => {
                        this.hide();
                        if (options.onSecondary) options.onSecondary();
                    };
                } else {
                    secondaryBtn.style.display = 'none';
                }

                // Show modal
                modal.style.display = 'flex';
                setTimeout(() => {
                    modal.querySelector('.custom-modal').classList.add('show');
                }, 10);

                // Auto-hide for success messages
                if (options.type === 'success' && !options.secondaryText) {
                    setTimeout(() => {
                        this.hide();
                    }, options.duration || 3000);
                }
            },

            hide() {
                const modal = document.getElementById('customModal');
                const modalContent = modal.querySelector('.custom-modal');
                modalContent.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            },

            getIcon(type) {
                const icons = {
                    success: '✓',
                    error: '✕',
                    warning: '⚠',
                    info: 'ℹ'
                };
                return icons[type] || icons.info;
            },

            // Convenience methods
            success(message, title = 'Success') {
                this.show({ type: 'success', title, message });
            },

            error(message, title = 'Error') {
                this.show({ type: 'error', title, message });
            },

            warning(message, title = 'Warning') {
                this.show({ type: 'warning', title, message });
            },

            info(message, title = 'Information') {
                this.show({ type: 'info', title, message });
            },

            confirm(message, onConfirm, onCancel, isDelete = false) {
                this.show({
                    type: isDelete ? 'error' : 'warning',
                    title: isDelete ? 'Delete Project' : 'Submit Project',
                    message,
                    primaryText: isDelete ? 'Delete' : 'Submit',
                    secondaryText: 'Cancel',
                    onPrimary: onConfirm,
                    onSecondary: onCancel
                });
            }
        };

        // Check authentication on page load
        checkAuth();

        async function checkAuth() {
            console.log('🔍 Checking authentication...');
            try {
                console.log('🔑 Auth object:', window.Auth);
                console.log('🔑 Token:', Auth.getToken());
                console.log('🔑 User:', Auth.getUser());
                
                const [userResponse, adminResponse] = await Promise.all([
                    Auth.authFetch('/me'),
                    Auth.authFetch('/admin/check')
                ]);

                console.log('👤 User response:', userResponse);
                console.log('👑 Admin response:', adminResponse);

                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    console.log('✅ User data:', userData);
                    console.log('✅ User data keys:', Object.keys(userData));
                    
                    // Check if user data has different structure
                    currentUser = userData.user || userData;
                    console.log('👤 Current user object:', currentUser);
                    console.log('👤 User object keys:', Object.keys(currentUser));
                    console.log('👤 User name property:', currentUser.name);
                    console.log('👤 User email property:', currentUser.email);
                    
                    // Handle display name logic
                    let displayName = 'User';
                    if (currentUser.name) {
                        // If name is exactly "Super Admin", use email prefix instead
                        if (currentUser.name.trim() === 'Super Admin') {
                            displayName = currentUser.email ? currentUser.email.split('@')[0] : 'Admin';
                        } else {
                            // Remove "Super Admin" from other names that contain it
                            displayName = currentUser.name.replace(/Super Admin/gi, '').trim();
                        }
                    } else if (currentUser.email) {
                        displayName = currentUser.email.split('@')[0]; // Use email prefix as name
                    }
                    console.log('👤 Final display name:', displayName);
                    
                    // Update both user name elements
                    const navUserNameElement = document.getElementById('navUserName');
                    const profileUserNameElement = document.getElementById('profileUserName');
                    
                    console.log('👤 Found navUserName element:', navUserNameElement);
                    console.log('👤 Found profileUserName element:', profileUserNameElement);
                    
                    if (navUserNameElement) {
                        navUserNameElement.textContent = displayName;
                        console.log('👤 Set nav user name to:', displayName);
                        
                        // Remove any existing click listeners to prevent duplicates
                        navUserNameElement.replaceWith(navUserNameElement.cloneNode(true));
                        const newNavUserNameElement = document.getElementById('navUserName');
                        
                        // Add click event to open My Account page
                        newNavUserNameElement.addEventListener('click', function() {
                            console.log('👤 Nav user name clicked, switching to account tab');
                            switchTab('account');
                        });
                    }
                    
                    if (profileUserNameElement) {
                        profileUserNameElement.textContent = displayName;
                        console.log('👤 Set profile user name to:', displayName);
                    }
                    
                    // Update user avatar with first letter
                    const userAvatar = document.getElementById('userAvatar');
                    if (userAvatar) {
                        userAvatar.textContent = displayName.charAt(0).toUpperCase();
                    } else {
                        console.error('❌ User name element not found!');
                    }

                    // Check if user is admin and show super admin button
                    if (adminResponse.ok) {
                        const adminData = await adminResponse.json();
                        console.log('👑 Admin data:', adminData);
                        if (adminData.isAdmin) {
                            const superAdminBtn = document.getElementById('superAdminBtn');
                            superAdminBtn.style.display = 'block';
                            superAdminBtn.onclick = () => window.location.href = 'admin.html';
                        }
                    }

                    loadLanguages();
                    loadProjects();
                } else {
                    console.log('❌ User not authenticated, redirecting to login');
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('❌ Authentication error:', error);
                // Set a fallback user name if authentication fails
                const navUserNameElement = document.getElementById('navUserName');
                const profileUserNameElement = document.getElementById('profileUserName');
                
                if (navUserNameElement) {
                    navUserNameElement.textContent = 'Guest User';
                    console.log('👤 Set fallback nav user name: Guest User');
                }
                
                if (profileUserNameElement) {
                    profileUserNameElement.textContent = 'Guest User';
                    console.log('👤 Set fallback profile user name: Guest User');
                }
                const userAvatar = document.getElementById('userAvatar');
                if (userAvatar) {
                    userAvatar.textContent = 'G';
                }
                window.location.href = 'login.html';
            }
        }

        async function logout() {
            Auth.clearAuth();
            await Auth.authFetch('/logout', { method: 'POST' });
            window.location.href = 'login.html';
        }

        function switchTab(tab) {
            console.log('🔍 Switching to tab:', tab);
            
            // Remove active class from all sidebar buttons
            document.querySelectorAll('.sidebar-btn').forEach(btn => {
                btn.classList.remove('active');
                console.log('🔍 Removed active from sidebar button:', btn.textContent.trim());
            });
            
            // Remove active class from all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                console.log('🔍 Removed active from tab content:', content.id);
            });

            // Add active class to selected sidebar button
            const selectedSidebarBtn = document.querySelector(`[data-tab="${tab}"]`);
            if (selectedSidebarBtn) {
                selectedSidebarBtn.classList.add('active');
                console.log('✅ Added active to sidebar button:', selectedSidebarBtn.textContent.trim());
            } else {
                console.log('❌ Sidebar button not found for:', tab);
            }
            
            // Add active class to selected tab content
            const selectedTabContent = document.getElementById(tab + 'Tab');
            if (selectedTabContent) {
                selectedTabContent.classList.add('active');
                console.log('✅ Added active to tab content:', selectedTabContent.id);
            } else {
                console.log('❌ Tab content not found for:', tab + 'Tab');
            }

            // Load content based on tab
            if (tab === 'projects') {
                console.log('🔍 Loading projects...');
                loadProjects();
            } else if (tab === 'completed') {
                console.log('🔍 Loading completed projects...');
                loadCompletedProjects();
            } else if (tab === 'create') {
                console.log('🔍 Switched to create tab');
            } else if (tab === 'account') {
                console.log('🔍 Loading account data...');
                loadAccountData();
            }
        }

        async function loadLanguages() {
            try {
                const response = await Auth.authFetch('/languages');
                const data = await response.json();
                availableLanguages = data;
                renderLanguages();
            } catch (error) {
                console.error('Error loading languages:', error);
            }
        }

        let filteredLanguages = {};

        function renderLanguages() {
            const languageList = document.getElementById('languageList');
            languageList.innerHTML = '';

            const searchTerm = document.getElementById('languageSearch').value.toLowerCase();
            filteredLanguages = {};

            Object.entries(availableLanguages).forEach(([name, price]) => {
                if (name.toLowerCase().includes(searchTerm)) {
                    filteredLanguages[name] = price;
                }
            });

            Object.entries(filteredLanguages).forEach(([name, price]) => {
                const option = document.createElement('div');
                option.style.cssText = 'padding: 12px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; border-bottom: 1px solid #f0f0f0;';
                option.onmouseover = () => option.style.background = selectedLanguages.includes(name) ? '#e3f2fd' : '#f8f9fa';
                option.onmouseout = () => option.style.background = selectedLanguages.includes(name) ? '#e3f2fd' : 'white';
                option.onclick = () => toggleLanguage(name);

                if (selectedLanguages.includes(name)) {
                    option.style.background = '#e3f2fd';
                    option.style.color = '#1976d2';
                }

                option.innerHTML = `
                    <div style="font-weight: 500;">${name}</div>
                    <div style="font-size: 18px; color: #28a745;">${selectedLanguages.includes(name) ? '✓' : ''}</div>
                `;

                languageList.appendChild(option);
            });

            updateSelectedLanguagesDisplay();
        }

        // Add search functionality
        document.addEventListener('DOMContentLoaded', function () {
            console.log('🔍 DOM Content Loaded');
            
            // Add click event listener to Create Project button
            const createProjectBtn = document.querySelector('.create-project-btn');
            if (createProjectBtn) {
                console.log('✅ Found Create Project button');
                createProjectBtn.addEventListener('click', function(e) {
                    console.log('🔍 Create Project button clicked!');
                    switchTab('create');
                });
            } else {
                console.log('❌ Create Project button not found');
            }
            
            setTimeout(() => {
                const searchInput = document.getElementById('languageSearch');
                if (searchInput) {
                    searchInput.addEventListener('input', renderLanguages);
                }
            }, 1000);
        });

        function updateSelectedLanguagesDisplay() {
            const textElement = document.getElementById('selectedLanguagesText');
            const tagsContainer = document.getElementById('selectedLanguagesTags');

            if (selectedLanguages.length === 0) {
                textElement.textContent = 'Choose languages...';
                tagsContainer.innerHTML = '';
            } else {
                textElement.textContent = `${selectedLanguages.length} language${selectedLanguages.length > 1 ? 's' : ''} selected`;

                tagsContainer.innerHTML = '';
                selectedLanguages.forEach(lang => {
                    const tag = document.createElement('div');
                    tag.style.cssText = 'background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.9em; display: flex; align-items: center; gap: 6px;';
                    tag.innerHTML = `
                        <span>${lang}</span>
                        <button class="remove-lang-btn" data-language="${lang}" style="background: rgba(255,255,255,0.3); border: none; color: white; border-radius: 50%; width: 18px; height: 18px; cursor: pointer; font-size: 12px;">×</button>
                    `;
                    
                    // Add event listener to the remove button
                    const removeBtn = tag.querySelector('.remove-lang-btn');
                    removeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const languageToRemove = removeBtn.getAttribute('data-language');
                        console.log('🗑️ Removing language:', languageToRemove);
                        removeLanguage(languageToRemove);
                    });
                    
                    tagsContainer.appendChild(tag);
                });
            }
        }

        // Toggle dropdown visibility
        document.getElementById('languageDropdown').onclick = function (e) {
            e.stopPropagation();
            const options = document.getElementById('languageOptions');
            const arrow = document.getElementById('dropdownArrow');
            const dropdown = document.getElementById('languageDropdown');

            if (options.style.display === 'none' || !options.style.display) {
                options.style.display = 'block';
                arrow.style.transform = 'rotate(180deg)';
                dropdown.style.borderColor = '#4facfe';
                dropdown.style.borderBottomLeftRadius = '0';
                dropdown.style.borderBottomRightRadius = '0';
                // Focus search input
                setTimeout(() => {
                    document.getElementById('languageSearch').focus();
                }, 100);
            } else {
                options.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
                dropdown.style.borderColor = '#ddd';
                dropdown.style.borderRadius = '8px';
            }
        };

        // Close dropdown when clicking outside
        document.addEventListener('click', function (e) {
            const dropdown = document.getElementById('languageDropdown');
            const options = document.getElementById('languageOptions');
            const arrow = document.getElementById('dropdownArrow');

            if (!dropdown.contains(e.target) && !options.contains(e.target)) {
                options.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
                dropdown.style.borderColor = '#ddd';
                dropdown.style.borderRadius = '8px';
            }
        });

        window.removeLanguage = function (name) {
            const index = selectedLanguages.indexOf(name);
            if (index > -1) {
                selectedLanguages.splice(index, 1);
                renderLanguages();
            }
        };

        function selectProjectType(type) {
            selectedProjectType = type;

            // Update radio buttons
            document.querySelectorAll('input[name="projectType"]').forEach(radio => {
                radio.checked = radio.value === type;
            });

            // Update visual selection
            document.querySelectorAll('.project-type-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById(type + 'Option').classList.add('selected');
        }

        function toggleLanguage(name) {
            const index = selectedLanguages.indexOf(name);
            if (index > -1) {
                selectedLanguages.splice(index, 1);
            } else {
                selectedLanguages.push(name);
            }
            renderLanguages();
        }

        // File input change handler - moved to addEventListener in DOMContentLoaded
        // This was causing conflicts with the proper event handler

        async function analyzeFile() {
            console.log('🚀 analyzeFile function called!');
            const projectName = document.getElementById('projectName').value;
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!projectName.trim()) {
                showError('Please enter a project name');
                return;
            }

            if (!file) {
                showError('Please select an Excel file');
                return;
            }

            if (selectedLanguages.length === 0) {
                showError('Please select at least one language');
                return;
            }

            // Show the analysis loading modal
            showAnalysisLoading();
            showLoading(true);

            const formData = new FormData();
            formData.append('file', file);
            formData.append('languages', JSON.stringify(selectedLanguages));
            formData.append('projectType', selectedProjectType);

            try {
                const response = await Auth.authFetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    // Complete all steps before showing results
                    for (let i = 1; i <= 5; i++) {
                        completeStep(i);
                    }
                    
                    // Wait a moment for the final step to be visible
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    currentAnalysis = {
                        projectName,
                        fileName: result.fileName,
                        wordCount: result.wordCount,
                        projectType: result.projectType,
                        multiplier: result.multiplier,
                        breakdown: result.breakdown,
                        subtotal: result.subtotal,
                        projectManagementCost: result.projectManagementCost || '500.00',
                        total: result.total,
                        tempFileId: result.tempFileId
                    };
                    showResults(result);
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('Network error. Please try again.');
            }

            // Hide the analysis loading modal
            hideAnalysisLoading();
            showLoading(false);
        }

        function showResults(data) {
            console.log('Analysis data:', data); // Debug log
            const content = document.getElementById('resultsContent');
            
            // Ensure close button is properly set up
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            if (modalCloseBtn) {
                // Remove any existing listeners to prevent duplicates
                modalCloseBtn.replaceWith(modalCloseBtn.cloneNode(true));
                const newModalCloseBtn = document.getElementById('modalCloseBtn');
                newModalCloseBtn.addEventListener('click', function(e) {
                    console.log('🔧 Modal close button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                });
            }

            let breakdownHtml = '';
            data.breakdown.forEach(item => {
                breakdownHtml += `
                    <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee;">
                        <span>${item.language}</span>
                        <span>$${item.cost}</span>
                    </div>
                `;
            });

            content.innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>File:</span>
                        <span>${data.fileName}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Total Words:</span>
                        <span>${data.wordCount.toLocaleString()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Project Type:</span>
                        <span style="font-weight: 600; color: ${data.projectType === 'pure' ? '#ffd700' : '#4facfe'};">
                            ${data.projectType === 'pure' ? 'Pure (Premium)' : 'Fusion (Standard)'}
                            ${data.multiplier > 1 ? ` (${data.multiplier}x)` : ''}
                        </span>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">💰 Translation Costs</h3>
                    <div>${breakdownHtml}</div>
                    <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; font-weight: 500;">
                        <span>Subtotal</span>
                        <span>$${data.subtotal}</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">📋 Additional Costs</h3>
                    <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee;">
                        <span>Project Management</span>
                        <span>$${data.projectManagementCost || '500.00'}</span>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 20px; border-radius: 8px; text-align: center;">
                    <div>Grand Total</div>
                    <div style="font-size: 2em; font-weight: bold;">$${data.total}</div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">📝 Notes for Admin (Optional)</h3>
                    <textarea id="projectNotes" 
                              placeholder="Add any special instructions, requirements, or notes for the admin team..."
                              style="width: 100%; min-height: 100px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; resize: vertical;"
                    ></textarea>
                </div>
            `;

            document.getElementById('resultsModal').classList.add('show');
            
            // Re-attach button listeners when modal is shown
            console.log('🔧 Modal shown, re-attaching button listeners...');
            setTimeout(() => {
                attachModalButtonListeners();
            }, 100);
        }
        
        function attachModalButtonListeners() {
            // Save project button
            const saveProjectBtn = document.getElementById('saveProjectBtn');
            console.log('🔍 Re-attaching saveProjectBtn:', saveProjectBtn);
            if (saveProjectBtn) {
                // Remove existing listeners by cloning
                const newSaveBtn = saveProjectBtn.cloneNode(true);
                saveProjectBtn.parentNode.replaceChild(newSaveBtn, saveProjectBtn);
                
                newSaveBtn.addEventListener('click', function(e) {
                    console.log('🔧 Save Project button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    saveProject();
                });
                console.log('✅ Save Project button listener re-attached');
            }
            
            // Modal close button (X button)
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            console.log('🔍 Re-attaching modalCloseBtn:', modalCloseBtn);
            if (modalCloseBtn) {
                const newModalCloseBtn = modalCloseBtn.cloneNode(true);
                modalCloseBtn.parentNode.replaceChild(newModalCloseBtn, modalCloseBtn);
                
                newModalCloseBtn.addEventListener('click', function(e) {
                    console.log('🔧 Modal close button (X) clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                });
                console.log('✅ Modal close button (X) listener re-attached');
            }
            
            // Close buttons
            const closeBtn = document.getElementById('closeModalBtn2');
            console.log('🔍 Re-attaching closeModalBtn2:', closeBtn);
            if (closeBtn) {
                const newCloseBtn = closeBtn.cloneNode(true);
                closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);
                
                newCloseBtn.addEventListener('click', function(e) {
                    console.log('🔧 Close modal button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                });
                console.log('✅ Close modal button listener re-attached');
            }
        }

        async function saveProject() {
            console.log('🔧 Save Project function called');
            console.log('🔍 Current analysis data:', currentAnalysis);
            
            if (!currentAnalysis) {
                console.error('❌ No current analysis data');
                CustomModal.warning('No project data to save. Please analyze a file first.');
                return;
            }

            // Get notes from the textarea
            const notesEl = document.getElementById('projectNotes');
            const notes = notesEl ? (notesEl.value || '').trim() : '';
            const projectData = {
                ...currentAnalysis,
                notes: notes
            };

            console.log('📤 Sending project data to server:', projectData);

            try {
                const response = await Auth.authFetch('/projects', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(projectData)
                });

                console.log('📥 Server response:', response);
                console.log('📥 Response status:', response.status);
                const contentType = response.headers.get('content-type') || '';

                if (response.ok) {
                    try {
                        if (contentType.includes('application/json')) {
                            // Safely attempt to parse JSON if present
                            try { await response.json(); } catch (_) {}
                        }
                        console.log('✅ Project saved successfully');
                        try { CustomModal.success('Project saved successfully!'); } catch (_) {}
                        try { closeModal(); } catch (_) {}
                        try { resetCreateForm(); } catch (_) {}
                        try { switchTab('projects'); } catch (_) {}
                        try { loadProjects(); } catch (_) {}
                    } catch (noop) {
                        console.warn('Post-save UI update warning:', noop);
                    }
                    return;
                } else {
                    let serverMessage = 'Unknown error';
                    try {
                        if (contentType.includes('application/json')) {
                            const data = await response.json();
                            serverMessage = data.error || JSON.stringify(data);
                        } else {
                            const txt = await response.text();
                            serverMessage = txt?.slice(0, 500) || 'Non-JSON error';
                        }
                    } catch (e) {
                        console.warn('Failed to parse error body:', e);
                    }
                    console.error('❌ Server error:', serverMessage);
                    CustomModal.error('Error saving project: ' + serverMessage);
                    showError(serverMessage);
                }
            } catch (error) {
                console.error('❌ Network error:', error);
                CustomModal.error('Network error saving project: ' + (error?.message || 'Request failed'));
                showError('Error saving project');
            }
        }

        function closeModal() {
            console.log('🔧 Close Modal function called');
            const modalEl = document.getElementById('resultsModal');
            if (modalEl && modalEl.classList) {
                modalEl.classList.remove('show');
            } else {
                console.warn('resultsModal element not found when trying to close');
            }
        }

        function resetCreateForm() {
            document.getElementById('projectName').value = '';
            document.getElementById('fileInput').value = '';
            document.getElementById('fileName').textContent = '';
            document.getElementById('fileName').classList.remove('show');
            selectedLanguages = [];
            selectedProjectType = 'fusion';
            renderLanguages();
            selectProjectType('fusion');
            currentAnalysis = null;
            const options = document.getElementById('languageOptions');
            const dropdown = document.getElementById('languageDropdown');
            const arrow = document.getElementById('dropdownArrow');

            options.style.display = 'none';
            arrow.style.transform = 'rotate(0deg)';
            dropdown.style.borderColor = '#ddd';
            dropdown.style.borderRadius = '8px';
            document.getElementById('languageSearch').value = '';
        }

        async function loadProjects() {
            console.log('📋 Loading active projects...');
            try {
                const response = await Auth.authFetch('/projects');
                console.log('📋 Projects response:', response);
                const allProjects = await response.json();
                console.log('📋 All projects data:', allProjects);
                
                // Filter out completed projects
                const activeProjects = allProjects.filter(project => project.status !== 'completed');
                console.log('📋 Active projects:', activeProjects);
                
                renderProjects(activeProjects, 'projectsList');
            } catch (error) {
                console.error('❌ Error loading projects:', error);
            }
        }

        async function loadCompletedProjects() {
            console.log('📋 Loading completed projects...');
            try {
                const response = await Auth.authFetch('/projects');
                console.log('📋 Projects response:', response);
                const allProjects = await response.json();
                console.log('📋 All projects data:', allProjects);
                
                // Filter only completed projects
                const completedProjects = allProjects.filter(project => project.status === 'completed');
                console.log('📋 Completed projects:', completedProjects);
                
                renderProjects(completedProjects, 'completedProjectsList');
            } catch (error) {
                console.error('❌ Error loading completed projects:', error);
            }
        }

        function renderProjects(projects, containerId = 'projectsList') {
            const container = document.getElementById(containerId);

            console.log('Rendering projects:', projects, 'in container:', containerId);

            if (projects.length === 0) {
                const emptyMessage = containerId === 'completedProjectsList' 
                    ? '<h3>No completed projects yet</h3><p>Completed projects will appear here</p>'
                    : '<h3>No projects yet</h3><p>Create your first project to get started</p>';
                
                container.innerHTML = `
                    <div class="empty-state">
                        ${emptyMessage}
                    </div>
                `;
                return;
            }

            // FULL PROJECT CARDS - Using the working 250px width approach
            let html = '<div class="cards-container" style="padding: 20px;">';

            projects.forEach((project, index) => {
                const date = new Date(project.createdAt).toLocaleDateString();
                const projectType = ((project.projectType || project.project_type || 'fusion') + '').toLowerCase();
                const statusClass = getStatusClass(project.status);

                html += `
                    <div class="project-card">
                        <div class="card-content">
                            <div class="card-header">
                                <div class="card-title">${project.name}</div>
                                <div class="card-meta">
                                    <div class="card-date">${date}</div>
                                    <div class="kebab-wrap">
                                        <button class="kebab-btn" data-project-id="${project.id}" aria-haspopup="true" aria-expanded="false" aria-label="Actions">⋮</button>
                                        <div class="action-menu" data-project-id="${project.id}">
                                            ${project.status === 'quote_generated' ? `
                                                <button class="menu-item submit-project-btn" data-project-id="${project.id}">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                    </svg>
                                                    Submit Project
                                                </button>
                                                <button class="menu-item delete-project-btn" data-project-id="${project.id}">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                                    </svg>
                                                    Delete
                                                </button>
                                            ` : `
                                                ${project.translatedFileName ? `
                                                    <button class="menu-item" onclick="downloadTranslatedFile('${project.id}', '${project.translatedFileName}')">
                                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                                        </svg>
                                                        Download File
                                                    </button>
                                                ` : `
                                                    <button class="menu-item" disabled>
                                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                                        </svg>
                                                        No File Available
                                                    </button>
                                                `}
                                            `}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="status-badge ${statusClass}">${getStatusText(project.status)}</div>
                            
                            <div class="project-details">
                                <div class="detail-item">
                                    <div class="detail-label">File</div>
                                    <div class="detail-value">${project.fileName}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Words</div>
                                    <div class="detail-value">${(project.wordCount || 0).toLocaleString()}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Type</div>
                                    <div class="detail-value">
                                        <span class="project-type ${projectType}">${projectType === 'pure' ? 'Pure' : 'Fusion'}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-amount">$${project.total}</div>
                        </div>
                        
                        <div class="project-actions">
                            <button class="view-details-btn btn btn-full btn-primary" data-project-id="${project.id}">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                                View Details
                            </button>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
            
            // Attach event listeners to dynamically created buttons
            attachProjectButtonListeners();
        }

        function getStatusClass(status) {
            const classes = {
                'quote_generated': 'quote',
                'submitted': 'submitted',
                'in_progress': 'in-progress',
                'proofreading': 'proofreading',
                'ready': 'ready',
                'completed': 'completed'
            };
            return classes[status] || 'quote';
        }

        function getStatusColor(status) {
            const colors = {
                'quote_generated': '#856404',
                'submitted': '#0c5460',
                'in_progress': '#0c5460',
                'proofreading': '#6f42c1',
                'ready': '#fd7e14',
                'completed': '#155724'
            };
            return colors[status] || '#666';
        }

        function getStatusText(status) {
            const texts = {
                'quote_generated': 'Quote Generated',
                'submitted': 'Submitted',
                'in_progress': 'In Progress',
                'proofreading': 'Proofreading',
                'ready': 'Ready',
                'completed': 'Completed'
            };
            return texts[status] || status;
        }

        async function submitProject(id) {
            console.log('🔍 Submitting project with ID:', id);
            CustomModal.confirm(
                'Are you sure you want to submit this project? Once submitted, you cannot delete it.',
                async () => {
                    try {
                        console.log('🔍 Making submit request for project:', id);
                        const response = await Auth.authFetch(`/projects/${id}/submit`, {
                            method: 'PUT'
                        });

                        console.log('🔍 Submit response status:', response.status);
                        console.log('🔍 Submit response ok:', response.ok);

                        if (response.ok) {
                            loadProjects();
                            CustomModal.success('Project submitted successfully!');
                        } else {
                            const data = await response.json();
                            console.error('❌ Submit error response:', data);
                            CustomModal.error('Error submitting project: ' + data.error);
                        }
                    } catch (error) {
                        console.error('❌ Submit error:', error);
                        console.error('❌ Submit error message:', error.message);
                        CustomModal.error('Network error submitting project');
                    }
                },
                () => {},
                false
            );
        }

        async function deleteProject(id) {
            console.log('🔍 Deleting project with ID:', id);
            CustomModal.confirm(
                'Are you sure you want to delete this project? This action cannot be undone.',
                async () => {
                    try {
                        console.log('🔍 Making delete request for project:', id);
                        const response = await Auth.authFetch(`/projects/${id}`, { method: 'DELETE' });
                        
                        console.log('🔍 Delete response status:', response.status);
                        console.log('🔍 Delete response ok:', response.ok);
                        
                        if (response.ok) {
                            loadProjects();
                            CustomModal.success('Project deleted successfully!');
                        } else {
                            const data = await response.json();
                            console.error('❌ Delete error response:', data);
                            CustomModal.error('Error deleting project: ' + data.error);
                        }
                    } catch (error) {
                        console.error('❌ Delete error:', error);
                        console.error('❌ Delete error message:', error.message);
                        CustomModal.error('Network error deleting project');
                    }
                },
                () => {},
                true
            );
        }

        async function downloadTranslatedFile(projectId, fileName) {
            console.log('🔍 Downloading translated file:', { projectId, fileName });
            
            try {
                // Show loading state
                CustomModal.show({
                    type: 'info',
                    title: 'Downloading File',
                    message: `Preparing ${fileName} for download...`,
                    primaryText: 'OK'
                });
                
                const response = await Auth.authFetch(`/projects/${projectId}/download-translated`, {
                    method: 'GET'
                });
                
                console.log('🔍 Download response:', response);
                
                if (response.ok) {
                    // Handle actual file download
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    // Show success message
                    CustomModal.show({
                        type: 'success',
                        title: 'Download Complete',
                        message: `Your translated file "${fileName}" has been downloaded successfully!`,
                        primaryText: 'OK'
                    });
                    
                } else {
                    const data = await response.json();
                    console.error('❌ Download error:', data);
                    CustomModal.show({
                        type: 'error',
                        title: 'Download Failed',
                        message: data.error || 'Failed to download file',
                        primaryText: 'OK'
                    });
                }
            } catch (error) {
                console.error('❌ Download error:', error);
                CustomModal.show({
                    type: 'error',
                    title: 'Download Failed',
                    message: 'Network error while downloading file',
                    primaryText: 'OK'
                });
            }
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.style.display = 'block';
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('analyzeBtn').disabled = show;
        }

        // Modern SaaS Analysis Loading Modal Functions
        function showAnalysisLoading() {
            const modal = document.getElementById('analysisLoadingModal');
            modal.style.display = 'flex';
            
            // Reset all steps
            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('completed', 'active');
            }
            
            // Start step animation with 7-8 second total duration
            setTimeout(() => activateStep(1), 800);
            setTimeout(() => completeStep(1), 1600);
            setTimeout(() => activateStep(2), 2000);
            setTimeout(() => completeStep(2), 2800);
            setTimeout(() => activateStep(3), 3200);
            setTimeout(() => completeStep(3), 4000);
            setTimeout(() => activateStep(4), 4400);
            setTimeout(() => completeStep(4), 5200);
            setTimeout(() => activateStep(5), 5600);
            setTimeout(() => completeStep(5), 6400);
            
            // Total duration: ~7.5 seconds
        }

        function hideAnalysisLoading() {
            const modal = document.getElementById('analysisLoadingModal');
            modal.style.display = 'none';
        }

        function activateStep(stepNumber) {
            const step = document.getElementById(`step${stepNumber}`);
            if (step) {
                step.classList.add('active');
            }
        }

        function completeStep(stepNumber) {
            const step = document.getElementById(`step${stepNumber}`);
            if (step) {
                step.classList.remove('active');
                step.classList.add('completed');
            }
        }

        function attachProjectButtonListeners() {
            console.log('🔧 Attaching project button listeners...');
            
            // View details buttons
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const projectId = this.getAttribute('data-project-id');
                    console.log('🔧 View details clicked:', projectId);
                    showProjectDetails(projectId);
                });
            });
            
            // Kebab toggle
            document.addEventListener('click', function(e) {
                const kebab = e.target.closest('.kebab-btn');
                const anyWrap = e.target.closest('.kebab-wrap');
                // Close all menus first
                document.querySelectorAll('.action-menu').forEach(m => m.classList.remove('open'));
                document.querySelectorAll('.kebab-btn[aria-expanded="true"]').forEach(b => b.setAttribute('aria-expanded','false'));
                if (kebab) {
                    const wrap = kebab.closest('.kebab-wrap');
                    const menu = wrap && wrap.querySelector('.action-menu');
                    if (menu) {
                        menu.classList.add('open');
                        kebab.setAttribute('aria-expanded','true');
                    }
                    e.preventDefault();
                    e.stopPropagation();
                } else if (anyWrap) {
                    // clicks inside wrap but not on button should keep it open
                    const menu = anyWrap.querySelector('.action-menu');
                    if (menu) menu.classList.add('open');
                }
            });
            
            // Submit project buttons
            document.querySelectorAll('.submit-project-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const projectId = this.getAttribute('data-project-id');
                    console.log('🔧 Submit project clicked:', projectId);
                    submitProject(projectId);
                });
            });
            
            // Delete project buttons
            document.querySelectorAll('.delete-project-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const projectId = this.getAttribute('data-project-id');
                    console.log('🔧 Delete project clicked:', projectId);
                    deleteProject(projectId);
                });
            });
            
            console.log('✅ Project button listeners attached');
        }

        async function showProjectDetails(projectId) {
            console.log('🔍 Showing project details for:', projectId);
            
            // Get all projects from the main endpoint
            try {
                const response = await Auth.authFetch('/projects');
                if (response.ok) {
                    const projects = await response.json();
                    console.log('📊 All projects:', projects);
                    
                    const project = projects.find(p => p.id == projectId);
                    
                    if (!project) {
                        console.error('❌ Project not found:', projectId);
                        CustomModal.error('Project not found');
                        return;
                    }
                    
                    const date = new Date(project.createdAt || project.created_at).toLocaleDateString();
                    
                    // Create detailed cost breakdown
                    let breakdownHtml = '';
                    let subtotal = 0;
                    if (project.breakdown && project.breakdown.length > 0) {
                        // Calculate subtotal from breakdown
                        subtotal = project.breakdown.reduce((sum, item) => sum + parseFloat(item.cost || 0), 0);
                        
                        breakdownHtml = `
                            <div class="cost-breakdown">
                                <h4>Translation Costs Breakdown</h4>
                                ${project.breakdown.map(item => `
                                    <div class="cost-item">
                                        <span class="language">${item.language}</span>
                                        <span class="cost">$${parseFloat(item.cost || 0).toFixed(2)}</span>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        // Fallback: use project.subtotal if breakdown is not available
                        subtotal = parseFloat(project.subtotal || 0);
                    }
                    
                    const statusClass = getStatusClass(project.status);
                    const projectType = (project.projectType || project.project_type || 'fusion') === 'pure' ? 'Pure' : 'Fusion';
                    const projectManagementCost = parseFloat(project.projectManagementCost || project.project_management_cost || 500);
                    const total = parseFloat(project.total);
                    
                    const modalContent = `
                        <div class="project-details-grid">
                            <div class="detail-row">
                                <span class="detail-label">Project Name</span>
                                <span class="detail-value">${project.name}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Project ID</span>
                                <span class="detail-value">${project.projectId || project.project_id || 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Created Date</span>
                                <span class="detail-value">${date}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">File Name</span>
                                <span class="detail-value">${project.fileName || project.file_name}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Word Count</span>
                                <span class="detail-value">${(project.wordCount || project.word_count || 0).toLocaleString()}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Project Type</span>
                                <span class="detail-value">${projectType}${(project.multiplier && project.multiplier > 1) ? ` (${project.multiplier}x)` : ''}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Status</span>
                                <span class="detail-value">
                                    <span class="status-badge ${statusClass}">${getStatusText(project.status)}</span>
                                </span>
                            </div>
                            ${project.eta ? `
                                <div class="detail-row">
                                    <span class="detail-label">ETA</span>
                                    <span class="detail-value">${project.eta} working days</span>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${breakdownHtml}
                        
                        <div class="cost-summary">
                            <div class="cost-summary-row subtotal">
                                <span class="cost-summary-label">Subtotal</span>
                                <span class="cost-summary-value">$${subtotal.toFixed(2)}</span>
                            </div>
                            <div class="cost-summary-row">
                                <span class="cost-summary-label">Project Management</span>
                                <span class="cost-summary-value">$${projectManagementCost.toFixed(2)}</span>
                            </div>
                            <div class="cost-summary-row total">
                                <span class="cost-summary-label">Total</span>
                                <span class="cost-summary-value total">$${total.toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('projectDetailsContent').innerHTML = modalContent;
                    document.getElementById('projectDetailsModal').style.display = 'block';
                    
                    // Ensure modal can be closed reliably
                    const pdModal = document.getElementById('projectDetailsModal');
                    const pdClose = document.getElementById('closeProjectDetailsBtn');
                    if (pdClose) {
                        const closeHandler = function(e){
                            e.preventDefault();
                            e.stopPropagation();
                            closeProjectDetailsModal();
                        };
                        pdClose.onclick = closeHandler;
                    }
                    if (pdModal) {
                        const outsideHandler = function(e){
                            if (e.target === pdModal) {
                                closeProjectDetailsModal();
                            }
                        };
                        // add once to avoid stacking multiple listeners
                        pdModal.addEventListener('click', outsideHandler, { once: true });
                    }
                    const escHandler = function(e){
                        if (e.key === 'Escape') {
                            closeProjectDetailsModal();
                            document.removeEventListener('keydown', escHandler);
                        }
                    };
                    document.addEventListener('keydown', escHandler);
                     
                 } else {
                     console.error('❌ Failed to load projects');
                     CustomModal.error('Failed to load project details');
                 }
            } catch (error) {
                console.error('❌ Error loading project details:', error);
                CustomModal.error('Error loading project details');
            }
        }


        function closeProjectDetailsModal() {
            console.log('🔍 Closing project details modal');
            const modal = document.getElementById('projectDetailsModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('✅ Project details modal closed');
            } else {
                console.error('❌ Project details modal not found');
            }
        }

        async function loadAccountData() {
            try {
                console.log('🔍 Loading account data...');
                
                // Get current user data from localStorage
                currentUser = Auth.getUser();
                console.log('👤 Current user from localStorage:', currentUser);
                
                if (currentUser) {
                    document.getElementById('accountName').value = currentUser.name || '';
                    document.getElementById('accountEmail').value = currentUser.email || '';
                    document.getElementById('accountUserId').textContent = currentUser.user_id || 'N/A';
                    document.getElementById('accountType').textContent = currentUser.role || 'User';
                    document.getElementById('accountLicense').textContent = currentUser.license || 'Free';
                    document.getElementById('accountCreated').textContent = currentUser.created_at ? new Date(currentUser.created_at).toLocaleDateString() : 'N/A';
                }
                
                // Load user profile data from server
                try {
                    console.log('🔍 Fetching profile data from server...');
                    const profileResponse = await Auth.authFetch('/profile');
                    console.log('📡 Profile response status:', profileResponse.status);
                    
                    if (profileResponse.ok) {
                        const profileData = await profileResponse.json();
                        console.log('📊 Profile data from server:', profileData);
                        
                        document.getElementById('accountName').value = profileData.name || currentUser?.name || '';
                        document.getElementById('accountEmail').value = profileData.email || currentUser?.email || '';
                        document.getElementById('accountUserId').textContent = profileData.user_id || currentUser?.user_id || 'N/A';
                        document.getElementById('accountType').textContent = profileData.role || currentUser?.role || 'User';
                        document.getElementById('accountLicense').textContent = profileData.license || currentUser?.license || 'Free';
                        document.getElementById('accountCreated').textContent = profileData.created_at ? new Date(profileData.created_at).toLocaleDateString() : 'N/A';
                        
                        console.log('✅ Profile data updated in UI');
                    } else {
                        console.log('⚠️ Profile API failed with status:', profileResponse.status);
                        const errorData = await profileResponse.json().catch(() => ({}));
                        console.log('⚠️ Profile API error:', errorData);
                    }
                } catch (profileError) {
                    console.log('⚠️ Profile API not available, using local data:', profileError);
                }
                
                // Load project statistics
                try {
                    const projectsResponse = await Auth.authFetch('/projects');
                    if (projectsResponse.ok) {
                        const projects = await projectsResponse.json();
                        console.log('📊 All projects:', projects);
                        
                        const totalProjects = projects.length;
                        const completedProjects = projects.filter(p => p.status === 'completed').length;
                        
                        document.getElementById('totalProjects').textContent = totalProjects;
                        document.getElementById('completedProjects').textContent = completedProjects;
                        console.log('📊 Project stats:', { totalProjects, completedProjects });
                    } else {
                        console.log('⚠️ Projects API failed, setting defaults');
                        document.getElementById('totalProjects').textContent = '0';
                        document.getElementById('completedProjects').textContent = '0';
                    }
                } catch (projectsError) {
                    console.log('⚠️ Projects API not available, setting defaults:', projectsError);
                    document.getElementById('totalProjects').textContent = '0';
                    document.getElementById('completedProjects').textContent = '0';
                }
                
                // Load notification preferences (optional)
                try {
                    const notificationsResponse = await Auth.authFetch('/notifications/preferences');
                    if (notificationsResponse.ok) {
                        const prefs = await notificationsResponse.json();
                        document.getElementById('projectUpdates').checked = prefs.projectUpdates || false;
                        document.getElementById('newMessages').checked = prefs.newMessages || false;
                        document.getElementById('completedProjects').checked = prefs.completedProjects || false;
                    }
                } catch (error) {
                    console.log('⚠️ Notifications API not available, using defaults');
                    // Set default notification preferences
                    document.getElementById('projectUpdates').checked = true;
                    document.getElementById('newMessages').checked = true;
                    document.getElementById('completedProjects').checked = true;
                }
                
                console.log('✅ Account data loaded successfully');
                
            } catch (error) {
                console.error('❌ Error loading account data:', error);
                // Set default values if API calls fail
                currentUser = Auth.getUser();
                if (currentUser) {
                    document.getElementById('accountName').value = currentUser.name || '';
                    document.getElementById('accountEmail').value = currentUser.email || '';
                    document.getElementById('accountUserId').textContent = currentUser.user_id || 'N/A';
                    document.getElementById('accountType').textContent = currentUser.role || 'User';
                    document.getElementById('accountLicense').textContent = currentUser.license || 'Free';
                    document.getElementById('accountCreated').textContent = 'N/A';
                }
                document.getElementById('totalProjects').textContent = '0';
                document.getElementById('completedProjects').textContent = '0';
            }
        }

        async function updateProfile() {
            try {
                const name = document.getElementById('accountName').value.trim();
                
                if (!name) {
                    CustomModal.error('Please enter your full name');
                    return;
                }
                
                const response = await Auth.authFetch('/profile/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name
                    })
                });
                
                if (response.ok) {
                    CustomModal.success('Profile updated successfully');
                    // Update the user name in both locations
                    const navUserNameElement = document.getElementById('navUserName');
                    const profileUserNameElement = document.getElementById('profileUserName');
                    
                    if (navUserNameElement) {
                        navUserNameElement.textContent = name;
                    }
                    if (profileUserNameElement) {
                        profileUserNameElement.textContent = name;
                    }
                } else {
                    const data = await response.json();
                    CustomModal.error('Error updating profile: ' + (data.error || 'Unknown error'));
                }
                
            } catch (error) {
                console.error('❌ Error updating profile:', error);
                CustomModal.error('Network error updating profile');
            }
        }

        async function changePassword() {
            try {
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (!currentPassword || !newPassword || !confirmPassword) {
                    CustomModal.error('Please fill in all password fields');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    CustomModal.error('New passwords do not match');
                    return;
                }
                
                if (newPassword.length < 6) {
                    CustomModal.error('New password must be at least 6 characters long');
                    return;
                }
                
                const response = await Auth.authFetch('/profile/change-password', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        currentPassword: currentPassword,
                        newPassword: newPassword
                    })
                });
                
                if (response.ok) {
                    CustomModal.success('Password changed successfully');
                    // Clear password fields
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    const data = await response.json();
                    CustomModal.error('Error changing password: ' + (data.error || 'Unknown error'));
                }
                
            } catch (error) {
                console.error('❌ Error changing password:', error);
                CustomModal.error('Network error changing password');
            }
        }

        async function updateNotifications() {
            try {
                const projectUpdates = document.getElementById('projectUpdates').checked;
                const newMessages = document.getElementById('newMessages').checked;
                const completedProjects = document.getElementById('completedProjects').checked;
                
                const response = await Auth.authFetch('/notifications/preferences', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        projectUpdates: projectUpdates,
                        newMessages: newMessages,
                        completedProjects: completedProjects
                    })
                });
                
                if (response.ok) {
                    CustomModal.success('Notification preferences updated successfully');
                } else {
                    const data = await response.json();
                    CustomModal.error('Error updating notifications: ' + (data.error || 'Unknown error'));
                }
                
            } catch (error) {
                console.error('❌ Error updating notifications:', error);
                CustomModal.error('Network error updating notifications');
            }
        }

        // Add event listeners after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 Setting up event listeners...');
            
            // Initialize file name display
            const fileNameElement = document.getElementById('fileName');
            if (fileNameElement) {
                fileNameElement.classList.remove('show');
                console.log('🔧 File name element initialized:', fileNameElement);
                console.log('🔧 Initial classes:', fileNameElement.className);
            } else {
                console.error('❌ File name element not found!');
            }
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    switchTab(tab);
                });
            });

            // Analyze button
            document.getElementById('analyzeBtn').addEventListener('click', analyzeFile);

            // Project type selection
            document.querySelectorAll('.project-type-option').forEach(option => {
                option.addEventListener('click', function() {
                    const projectType = this.getAttribute('data-project-type');
                    selectProjectType(projectType);
                });
            });

            // Close modal buttons
            const closeModalBtn = document.getElementById('closeModalBtn');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', closeModal);
            }
            const closeModalBtn2Element = document.getElementById('closeModalBtn2');
            if (closeModalBtn2Element) {
                closeModalBtn2Element.addEventListener('click', closeModal);
            }
            
            // Save project button
            const saveProjectBtn = document.getElementById('saveProjectBtn');
            console.log('🔍 Looking for saveProjectBtn:', saveProjectBtn);
            if (saveProjectBtn) {
                saveProjectBtn.addEventListener('click', function(e) {
                    console.log('🔧 Save Project button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    saveProject();
                });
                console.log('✅ Save Project button listener attached');
                
                // Test if button is clickable
                saveProjectBtn.style.pointerEvents = 'auto';
                saveProjectBtn.style.zIndex = '9999';
            } else {
                console.error('❌ Save Project button not found');
            }
            
            // Modal close button
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            console.log('🔍 Looking for modalCloseBtn:', modalCloseBtn);
            if (modalCloseBtn) {
                modalCloseBtn.addEventListener('click', function(e) {
                    console.log('🔧 Modal close button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                });
                console.log('✅ Modal close button listener attached');
                modalCloseBtn.style.pointerEvents = 'auto';
                modalCloseBtn.style.zIndex = '9999';
            } else {
                console.error('❌ Modal close button not found');
            }
            
            // Close modal button 2 - already handled above
            
            // Close project details modal button
            const closeProjectDetailsBtn = document.getElementById('closeProjectDetailsBtn');
            if (closeProjectDetailsBtn) {
                closeProjectDetailsBtn.addEventListener('click', function(e) {
                    console.log('🔧 Project details close button clicked!');
                    e.preventDefault();
                    e.stopPropagation();
                    closeProjectDetailsModal();
                });
                console.log('✅ Project details close button listener attached');
            } else {
                console.error('❌ Project details close button not found');
            }
            
            // Close project details modal when clicking outside
            const projectDetailsModal = document.getElementById('projectDetailsModal');
            if (projectDetailsModal) {
                projectDetailsModal.addEventListener('click', function(e) {
                    if (e.target === projectDetailsModal) {
                        closeProjectDetailsModal();
                    }
                });
                console.log('✅ Project details modal outside click listener attached');
            } else {
                console.error('❌ Project details modal not found');
            }
            
            // Language removal buttons (delegated event listener)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-lang-btn')) {
                    const language = e.target.getAttribute('data-language');
                    removeLanguage(language);
                }
            });
            
            // Project action buttons (delegated event listeners)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('submit-project-btn')) {
                    const projectId = e.target.getAttribute('data-project-id');
                    submitProject(projectId);
                }
                if (e.target.classList.contains('delete-project-btn')) {
                    const projectId = e.target.getAttribute('data-project-id');
                    deleteProject(projectId);
                }
            });

            // Modern file upload functionality
            const fileInput = document.getElementById('fileInput');
            const uploadZone = document.getElementById('uploadZone');
            const fileName = document.getElementById('fileName');

            // File input change
            fileInput.addEventListener('change', function() {
                console.log('🔍 File input change event triggered');
                const file = this.files[0];
                if (file) {
                    fileName.textContent = file.name;
                    fileName.classList.add('show');
                    console.log('✅ File selected and displayed:', file.name);
                    console.log('🔍 File name element classes:', fileName.className);
                    console.log('🔍 File name element display style:', window.getComputedStyle(fileName).display);
                    console.log('🔍 File name element visibility:', window.getComputedStyle(fileName).visibility);
                } else {
                    fileName.textContent = '';
                    fileName.classList.remove('show');
                    console.log('❌ No file selected, hiding file name');
                }
            });

            // Drag and drop functionality
            uploadZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    fileName.textContent = files[0].name;
                    fileName.classList.add('show');
                    console.log('✅ File dropped and displayed:', files[0].name);
                    console.log('🔍 File name element classes:', fileName.className);
                }
            });

            // Click to upload - label approach handles this automatically
            // But we'll keep the event listener for additional functionality
            uploadZone.addEventListener('click', function(e) {
                console.log('Upload zone clicked');
            });



            // Modern language dropdown
            const languageDropdown = document.getElementById('languageDropdown');
            const languageOptions = document.getElementById('languageOptions');
            const dropdownArrow = document.getElementById('dropdownArrow');

            languageDropdown.addEventListener('click', function(e) {
                e.stopPropagation();
                const isOpen = languageOptions.classList.contains('show');
                
                if (!isOpen) {
                    languageOptions.classList.add('show');
                    languageDropdown.classList.add('active');
                    document.getElementById('languageSearch').focus();
                } else {
                    hideLanguageDropdown();
                }
            });

            // Language search
            document.getElementById('languageSearch').addEventListener('input', function() {
                renderLanguages();
            });

            // Click outside to close dropdown
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#languageDropdown')) {
                    hideLanguageDropdown();
                }
            });

            // Cancel button functionality
            const cancelBtn = document.getElementById('cancelBtn');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    // Clear form
                    document.getElementById('projectName').value = '';
                    document.getElementById('fileInput').value = '';
                    document.getElementById('fileName').textContent = '';
                    document.getElementById('fileName').classList.remove('show');
                    document.getElementById('selectedLanguagesTags').innerHTML = '';
                    document.getElementById('selectedLanguagesText').textContent = 'Choose languages...';
                    
                    // Reset project type to Fusion
                    document.querySelector('input[name="projectType"][value="fusion"]').checked = true;
                    
                    // Hide language dropdown
                    hideLanguageDropdown();
                    
                    // Switch to projects tab
                    switchTab('projects');
                });
            }

            // Project type card selection
            document.querySelectorAll('.type-card').forEach(card => {
                card.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    
                    // Update visual state
                    document.querySelectorAll('.type-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
            
            // Account page buttons
            const updateProfileBtn = document.getElementById('updateProfileBtn');
            if (updateProfileBtn) {
                updateProfileBtn.addEventListener('click', updateProfile);
            }
            
            const changePasswordBtn = document.getElementById('changePasswordBtn');
            if (changePasswordBtn) {
                changePasswordBtn.addEventListener('click', changePassword);
            }
            
            const updateNotificationsBtn = document.getElementById('updateNotificationsBtn');
            if (updateNotificationsBtn) {
                updateNotificationsBtn.addEventListener('click', updateNotifications);
            }

            console.log('✅ Event listeners set up successfully');
        });

        // Also wire up radio changes for project type selection
        document.querySelectorAll('input[name="projectType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    selectProjectType(this.value);
                }
            });
        });

        // Hide language dropdown function
        function hideLanguageDropdown() {
            const languageOptions = document.getElementById('languageOptions');
            const languageDropdown = document.getElementById('languageDropdown');
            const dropdownArrow = document.getElementById('dropdownArrow');
            
            if (languageOptions) {
                languageOptions.classList.remove('show');
            }
            if (languageDropdown) {
                languageDropdown.classList.remove('active');
            }
            if (dropdownArrow) {
                dropdownArrow.style.transform = 'rotate(0deg)';
            }
        }
    </script>

    <style>
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .project-type-option {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .project-type-option:hover {
            border-color: #4facfe;
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.1);
        }

        .project-type-option.selected {
            border-color: #4facfe;
            background: #f8f9ff;
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.2);
        }

        .project-type-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .project-type-header h4 {
            margin: 0;
            color: #333;
            flex: 1;
        }

        .project-type-badge {
            background: #e2e8f0;
            color: #4a5568;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .project-type-badge.premium {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #744210;
        }

        .project-type-option p {
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .project-type-price {
            font-weight: 600;
            color: #4facfe;
            font-size: 0.9em;
        }
    </style>
</body>

</html>
</html>